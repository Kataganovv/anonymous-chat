<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä QR-–∫–æ–¥–∞ –¥–ª—è —á–∞—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .qr-generator {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #374151;
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .subtitle {
            color: #6b7280;
            font-size: 1.2rem;
            margin-bottom: 40px;
        }

        .url-input-section {
            margin-bottom: 30px;
        }

        .url-input-section label {
            display: block;
            color: #374151;
            font-weight: 500;
            margin-bottom: 10px;
            text-align: left;
        }

        .url-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #urlInput {
            flex: 1;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            font-family: monospace;
            background: white;
            transition: border-color 0.2s ease;
        }

        #urlInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .generate-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        .qr-display {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .qr-code-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        #qrCanvas {
            border-radius: 12px;
            max-width: 100%;
            height: auto;
        }

        .qr-info {
            color: #6b7280;
            font-size: 0.9rem;
            text-align: center;
            line-height: 1.5;
        }

        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .quick-link {
            padding: 15px;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: #374151;
        }

        .quick-link:hover {
            border-color: #667eea;
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .quick-link h3 {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .quick-link p {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .download-section {
            margin-top: 30px;
        }

        .download-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin: 0 10px;
            transition: all 0.2s ease;
        }

        .download-btn:hover {
            background: #059669;
            transform: scale(1.05);
        }

        .status {
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 10px 0;
            display: inline-block;
        }

        .status.success {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 2px solid rgba(16, 185, 129, 0.2);
        }

        .status.info {
            background: rgba(59, 130, 246, 0.1);
            color: #1d4ed8;
            border: 2px solid rgba(59, 130, 246, 0.2);
        }

        @media (max-width: 768px) {
            .qr-generator {
                padding: 20px;
                margin: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .url-input-container {
                flex-direction: column;
            }

            .quick-links {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="qr-generator">
        <h1>üéØ QR-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —á–∞—Ç–∞</h1>
        <p class="subtitle">–°–æ–∑–¥–∞–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –ª—é–±–æ–π —Å—Å—ã–ª–∫–∏</p>

        <div class="url-input-section">
            <label for="urlInput">–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à —á–∞—Ç:</label>
            <div class="url-input-container">
                <input type="url" id="urlInput" placeholder="https://your-chat-link.com" />
                <button class="generate-btn" onclick="generateQR()">–°–æ–∑–¥–∞—Ç—å QR</button>
            </div>
        </div>

        <div class="quick-links">
            <div class="quick-link" onclick="setQuickUrl('localhost')">
                <h3>üíª –õ–æ–∫–∞–ª—å–Ω—ã–π —á–∞—Ç</h3>
                <p>http://localhost:8000</p>
            </div>
            <div class="quick-link" onclick="detectCurrentUrl()">
                <h3>üåê –¢–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä</h3>
                <p>–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</p>
            </div>
            <div class="quick-link" onclick="setQuickUrl('demo')">
                <h3>üéÆ –î–µ–º–æ —á–∞—Ç</h3>
                <p>–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏</p>
            </div>
        </div>

        <div class="qr-display" id="qrDisplay" style="display: none;">
            <div class="qr-code-container">
                <canvas id="qrCanvas"></canvas>
                <div class="qr-info">
                    <strong>–ì–æ—Ç–æ–≤–æ!</strong><br>
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º QR-–∫–æ–¥–æ–º —Å –¥—Ä—É–∑—å—è–º–∏<br>
                    –û–Ω–∏ —Å–º–æ–≥—É—Ç –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —á–∞—Ç—É
                </div>
            </div>
            <div class="download-section">
                <button class="download-btn" onclick="downloadQR()">üì• –°–∫–∞—á–∞—Ç—å PNG</button>
                <button class="download-btn" onclick="copyQRLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </div>
        </div>

        <div id="status"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        let currentUrl = '';

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            detectCurrentUrl();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ public_url.txt
            checkPublicUrl();
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL
        async function checkPublicUrl() {
            try {
                const response = await fetch('/public_url.txt');
                if (response.ok) {
                    const publicUrl = await response.text();
                    if (publicUrl.trim()) {
                        setUrl(publicUrl.trim());
                        showStatus('üåç –û–±–Ω–∞—Ä—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä!', 'success');
                        return;
                    }
                }
            } catch (e) {
                // –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
            }
            
            // Fallback –Ω–∞ —Ç–µ–∫—É—â–∏–π URL
            detectCurrentUrl();
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ URL
        function detectCurrentUrl() {
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            const port = window.location.port;
            
            let detectedUrl;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                detectedUrl = `${protocol}//${hostname}:${port || '8000'}/`;
            } else {
                detectedUrl = `${protocol}//${hostname}${port ? ':' + port : ''}/`;
            }
            
            setUrl(detectedUrl);
            showStatus('‚úÖ URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω', 'info');
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—ã—Å—Ç—Ä—ã—Ö URL
        function setQuickUrl(type) {
            switch(type) {
                case 'localhost':
                    setUrl('http://localhost:8000/');
                    break;
                case 'demo':
                    setUrl('https://example.com/demo-chat');
                    break;
                default:
                    detectCurrentUrl();
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ URL –∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR
        function setUrl(url) {
            document.getElementById('urlInput').value = url;
            currentUrl = url;
            generateQR();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞
        function generateQR() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É!', 'error');
                return;
            }

            if (!isValidUrl(url)) {
                showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É!', 'error');
                return;
            }

            currentUrl = url;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥
            const canvas = document.getElementById('qrCanvas');
            
            QRCode.toCanvas(canvas, url, {
                width: 280,
                margin: 3,
                color: {
                    dark: '#374151',
                    light: '#FFFFFF'
                },
                errorCorrectionLevel: 'M'
            }, function (error) {
                if (error) {
                    showStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–∞', 'error');
                    console.error(error);
                } else {
                    document.getElementById('qrDisplay').style.display = 'block';
                    showStatus('‚úÖ QR-–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                }
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ URL
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞
        function downloadQR() {
            const canvas = document.getElementById('qrCanvas');
            const link = document.createElement('a');
            link.download = 'chat-qr-code.png';
            link.href = canvas.toDataURL();
            link.click();
            
            showStatus('üì• QR-–∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!', 'success');
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        function copyQRLink() {
            navigator.clipboard.writeText(currentUrl).then(() => {
                showStatus('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            }).catch(() => {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const input = document.getElementById('urlInput');
                input.select();
                document.execCommand('copy');
                showStatus('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            });
        }

        // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            
            // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                statusEl.textContent = '';
                statusEl.className = '';
            }, 3000);
        }

        // Enter –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        document.getElementById('urlInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateQR();
            }
        });

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ public_url.txt
        setInterval(checkPublicUrl, 30000);
    </script>
</body>
</html>